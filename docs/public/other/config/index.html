<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Config - Light Ecosystem for Microservices</title>
    <meta name="generator" content="Hugo 0.20.6" />

    
    <meta name="description" content="Light Document">
    
    <link rel="canonical" href="https://networknt.github.io/other/config/">
    
    <meta name="author" content="Steve Hu">
    

    <meta property="og:url" content="https://networknt.github.io/other/config/">
    <meta property="og:title" content="Light Ecosystem for Microservices">
    <meta property="og:image" content="https://networknt.github.io/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Light Ecosystem for Microservices">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://networknt.github.io/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://networknt.github.io/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://networknt.github.io/fonts/icon.eot');
        src: url('https://networknt.github.io/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://networknt.github.io/fonts/icon.woff')
               format('woff'),
             url('https://networknt.github.io/fonts/icon.ttf')
               format('truetype'),
             url('https://networknt.github.io/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://networknt.github.io/stylesheets/application.css">
    <link rel="stylesheet" href="https://networknt.github.io/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://networknt.github.io/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://networknt.github.io/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://networknt.github.io/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Config
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/stevehu" title="@stevehu on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/networknt/light-doc" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://networknt.github.io/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Light Ecosystem for Microservices <span class="version">1.4.4</span></strong>
        
          <br>
          networknt/light-doc
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/networknt/light-doc/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/networknt/light-doc/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="https://networknt.github.io/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="https://networknt.github.io/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Design" href="https://networknt.github.io/design/">
	
	Design
</a>



  
</li>



<li>
  
    



<a  title="Middleware" href="https://networknt.github.io/middleware/">
	
	Middleware
</a>



  
</li>



<li>
  
    



<a  title="Server Components" href="https://networknt.github.io/server/">
	
	Server Components
</a>



  
</li>



<li>
  
    



<a  title="Client Components" href="https://networknt.github.io/client/">
	
	Client Components
</a>



  
</li>



<li>
  
    



<a  title="DevOps" href="https://networknt.github.io/devops/">
	
	DevOps
</a>



  
</li>



<li>
  
    



<a  title="Benchmark" href="https://networknt.github.io/benchmark/">
	
	Benchmark
</a>



  
</li>



<li>
  
    



<a  title="Tutorial" href="https://networknt.github.io/tutorial/">
	
	Tutorial
</a>



  
</li>



<li>
  
    



<a  title="Example" href="https://networknt.github.io/example/">
	
	Example
</a>



  
</li>



<li>
  
    



<a  title="Tool" href="https://networknt.github.io/tool/">
	
	Tool
</a>



  
</li>



<li>
  
    



<a  title="Issues &amp; Help" href="https://github.com/networknt/light-doc/issues">
	
	Issues &amp; Help
</a>



  
</li>



<li>
  
    



<a  title="Roadmap" href="https://networknt.github.io/roadmap/">
	
	Roadmap
</a>



  
</li>



<li>
  
    



<a  title="FAQ" href="https://networknt.github.io/faq/">
	
	FAQ
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://www.apache.org/licenses/LICENSE-2.0">
	
	License
</a>



  
</li>



<li>
  
    



<a  title="Introduction" href="https://networknt.github.io/index.html">
	
	Introduction
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/stevehu" target="_blank" title="@stevehu on GitHub">
              @stevehu on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:stevehu@gmail.com" title="Email of stevehu@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Config </h1>

			

<p>A configuration module that supports externalized config in official standalone
deployment or docker container. It is encouraged that every module should have
its own configuration file and these files can be served by light-config-server
which aggregates/merges config files from different level of organizations in
github or other git servers.</p>

<h2 id="introduction">Introduction</h2>

<p>Externalized configuration from the application package is very important. It
allows us to deploy the same package to DEV/SIT/UAT/PROD environment with
different configuration packages without reopening the delivery package. For
development, embedded configuration give us the flexibility to take default
values out of the box.</p>

<p>When dockerizing our application, the external configuration can be mapped to a
volume which can be updated and restarted the container to take effect.</p>

<p>When Kubernetes is used for docker orchestration, config files can be managed by
ConfigMap and Secret</p>

<p>The reason we encourage every module has its own configuration file is to ease
the management and facilitate individual module independence. Every module can
be upgraded independently and change its config format without impact other
modules.</p>

<p>Most config files are not sensitive and it is recommended to manage them in git
so that all the changes can be tracked and audited. With proper access control
to the organization/lob level of config repo, only certain users can update the
config files per environment.</p>

<p>There is one separate config file secret.yml that contains all the secrets in
the application like database password, private key etc. Although this file can
be checked into the git along with other config files, the content should be
just placeholders and it needs to be updated during deployment. With Kubernets,
this file will be mapped to Secrets.</p>

<p>For now, only file system configuration is supported; however, config files
can be served by light-config-server in a zip format and the server module
can be started to load all config from light-config-server in a zip file
format. It will automatically unzip it and put the config files into the
right location to bootstrap the server. Given the risk of single point failure,
only when the server start, it will contact external light-config-sever to load
(first time) or update local file system so that config files are cached. Except
first time start the server, the server can use the local cache to start if
config service is not available.</p>

<h2 id="singleton">Singleton</h2>

<p>For one JVM, there should be only one instance of Config and it should be
shared by all the modules within the application. The class is designed as a
singleton class and has several abstract methods that should be implemented
in sub classes. A default File System based implementation is provided. Other
implementation will be provided in the future when it is needed.
 </p>

<h2 id="interface">Interface</h2>

<p>The following abstract methods are implemented in the default service provider.</p>

<pre><code>    public abstract Map&lt;String, Object&gt; getJsonMapConfig(String configName);

    public abstract Map&lt;String, Object&gt; getJsonMapConfigNoCache(String configName);

    public abstract Object getJsonObjectConfig(String configName, Class clazz);

    public abstract String getStringFromFile(String filename);

    public abstract InputStream getInputStreamFromFile(String filename);

    public abstract ObjectMapper getMapper();

    public abstract Yaml getYaml();

    public abstract void clear();

</code></pre>

<h2 id="usage">Usage</h2>

<p>It is encouraged to create a POJO for your config if the JSON structure is static.
However, some of the config file have repeatable elements, a map or list is the
only options to represent the data in this case.</p>

<p>The two methods return String and InputStream is for loading files such as text
file with different format and X509 certificates etc.</p>

<p>getMapper() is a convenient way to get Jackson ObjectMapper instead of create one
which is too heavy.</p>

<h2 id="cache">Cache</h2>

<p>Loading configuration files from file system takes time so the config file will
be cached once it is loaded the first time. All subsequent access to the same
config file (maybe different key/value pair) will read from the cached copy.
In order to make sure that server start up won&rsquo;t be impacted by all modules to
load config files, lazy loading is encouraged unless the module must be
initialized during server start up.</p>

<p>The server <a href="https://networknt.github.io/light-4j/other/info/">info</a>
module will output the config files in map format for each enabled module and
it creates another un-cached copy with getJsonMapConfigNoCache as some of the
config contains sensitive info that needs to be masked. For example, secret.yml.</p>

<h2 id="loading-sequence">Loading sequence</h2>

<p>Each module should have a config file that named the same as the module name. And
each application or service built on top of light-4j framework should have a
config file named with application or service name if necessary.</p>

<p>For example, Security module as a config file named security.yml and it is
reside in the module /src/main/resources/config folder by default.</p>

<p>For application that uses Security module, it can override the default module
level config by provide security.yml in application&rsquo;s resource folder
/src/main/resources/config.</p>

<p>Config will also be loaded from class path of the application and this is
mainly used for testing as it is easy to inject different combination of
config copies in test cases into class path for unit testing.</p>

<p>For official runtime environment, config files should be externalized to a
separate folder outside of the package by a system property
&ldquo;light-4j-config-dir&rdquo;. You can start the server with
a &ldquo;-Dlight-4j-config-dir=/config&rdquo; option and put all your files
into /config. Once in docker image, it can be mapped to a host volume
with -v /etc/light-4j:/config in docker run command.</p>

<p>Given above explanation, the loading sequence is:</p>

<ol>
<li>System property &ldquo;light-4j-config-dir&rdquo; specified directory</li>
<li>Class Path</li>
<li>Application resources/config folder</li>
<li>Module resources/config folder</li>
</ol>

<p>Most modules will have a default config file with yml format and it can be
overwritten by putting a yml config in application/service resources/config
folder. For unit test and end-to-end test, you can create another copy of
yml config file under test/resources/config folder. If you need to test the
different behaviours under different configuration, you need to manually
manipulate config file in classpath in your test case in order to simulate
different configurations.</p>

<p>For official deploy environment, externalized config in light-4j-config-dir
is recommended; however, not all config files need to be externalized. Only
the ones that you might change from one environment to another or might be
changed on production under certain conditions.</p>

<p>The above loading sequence assumes that yml is used as config file extension. If
yaml or json is used, the loading sequence is the same. Remember you only use
one extension for a module and these extensions cannot be mixed.</p>

<p>The above loading sequence is for one extension and one extension only. For
different extensions, the loading sequence is:</p>

<ol>
<li>yml</li>
<li>yaml</li>
<li>json</li>
</ol>

<h2 id="format">Format</h2>

<p>The config module supports two file formats and three file extensions.</p>

<ul>
<li>YAML with extension yml and yaml</li>
<li>JSON with extension json</li>
</ul>

<p>YAML is highly recommended because it is easy to read/edit with comments inline</p>

<p>For each module, you can choose either YAML or JSON as config file format but
you cannot use both as there is a priority in loading sequence:</p>

<p>yml &gt; yaml &gt; json</p>

<p>Note that all default config files for light-4j and other framework built on
top of light-4j modules are using yml as config format except swagger.json
which is generated from swagger editor. If you want to overwrite the default
config for one of the modules, you must use the {module name}.yml in your app
config folder or externalized to config directory specified by system properties.</p>

<h2 id="example">Example</h2>

<p>Load config into static variable</p>

<pre><code>static final Map&lt;String, Object&gt; config = Config.getInstance().getJsonMapConfig(JwtHelper.SECURITY_CONFIG);
</code></pre>

<p>Load config when it is used</p>

<pre><code>ValidatorConfig config = (ValidatorConfig)Config.getInstance().getJsonObjectConfig(CONFIG_NAME, ValidatorConfig.class);
</code></pre>

<h2 id="config-server">Config Server</h2>

<p>With every module or application has its own config file, it is hard to manage
these files for different version of framework, different deployment environment.</p>

<p>In order to make it easier, we have provided a <a href="https://github.com/networknt/light-config-server">light-config-server</a>
to manage config files in multiple git organizations. The default config files
are provided by networknt organization in github. For companies to use
the framework, they can have an overwritten default config repo for each version
of framework for each environment. Also, each individual application or service
can have its overwritten config files for a framework version on a specific env.</p>

<p>For more information about light-config-server please check <a href="https://github.com/networknt/light-config-server">README.md</a></p>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://networknt.github.io/other/mask/" title="Mask">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Mask
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://networknt.github.io/other/client/" title="Client">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Client
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/networknt.github.io\/';
      var repo_id  = 'networknt\/light-doc';
    
    </script>

    <script src="https://networknt.github.io/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

