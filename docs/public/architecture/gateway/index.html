<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>API Gateway - Light Ecosystem for Microservices</title>
    <meta name="generator" content="Hugo 0.21-DEV" />

    
    <meta name="description" content="Light Document">
    
    <link rel="canonical" href="https://networknt.github.io/architecture/gateway/">
    
    <meta name="author" content="Steve Hu">
    

    <meta property="og:url" content="https://networknt.github.io/architecture/gateway/">
    <meta property="og:title" content="Light Ecosystem for Microservices">
    <meta property="og:image" content="https://networknt.github.io/images/logo.png">
    <meta name="apple-mobile-web-app-title" content="Light Ecosystem for Microservices">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://networknt.github.io/images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="https://networknt.github.io/images/favicon.ico">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://networknt.github.io/fonts/icon.eot');
        src: url('https://networknt.github.io/fonts/icon.eot')
               format('embedded-opentype'),
             url('https://networknt.github.io/fonts/icon.woff')
               format('woff'),
             url('https://networknt.github.io/fonts/icon.ttf')
               format('truetype'),
             url('https://networknt.github.io/fonts/icon.svg')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://networknt.github.io/stylesheets/application.css">
    <link rel="stylesheet" href="https://networknt.github.io/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://networknt.github.io/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://networknt.github.io/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="https://networknt.github.io/javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        API Gateway
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/stevehu" title="@stevehu on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://github.com/networknt/light-doc" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://networknt.github.io/images/logo.png">
        </div>
      
      <div class="name">
        <strong>Light Ecosystem for Microservices <span class="version">1.4.4</span></strong>
        
          <br>
          networknt/light-doc
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/networknt/light-doc/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/networknt/light-doc/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Getting started" href="https://networknt.github.io/getting-started/">
	
	Getting started
</a>



  
</li>



<li>
  
    



<a  title="Architecture" href="https://networknt.github.io/architecture/">
	
	Architecture
</a>



  
</li>



<li>
  
    



<a  title="Design" href="https://networknt.github.io/design/">
	
	Design
</a>



  
</li>



<li>
  
    



<a  title="Middleware" href="https://networknt.github.io/middleware/">
	
	Middleware
</a>



  
</li>



<li>
  
    



<a  title="Server Components" href="https://networknt.github.io/server/">
	
	Server Components
</a>



  
</li>



<li>
  
    



<a  title="Client Components" href="https://networknt.github.io/client/">
	
	Client Components
</a>



  
</li>



<li>
  
    



<a  title="DevOps" href="https://networknt.github.io/devops/">
	
	DevOps
</a>



  
</li>



<li>
  
    



<a  title="Benchmark" href="https://networknt.github.io/benchmark/">
	
	Benchmark
</a>



  
</li>



<li>
  
    



<a  title="Tutorial" href="https://networknt.github.io/tutorial/">
	
	Tutorial
</a>



  
</li>



<li>
  
    



<a  title="Example" href="https://networknt.github.io/example/">
	
	Example
</a>



  
</li>



<li>
  
    



<a  title="Tool" href="https://networknt.github.io/tool/">
	
	Tool
</a>



  
</li>



<li>
  
    



<a  title="Issues &amp; Help" href="https://github.com/networknt/light-doc/issues">
	
	Issues &amp; Help
</a>



  
</li>



<li>
  
    



<a  title="Roadmap" href="https://networknt.github.io/roadmap/">
	
	Roadmap
</a>



  
</li>



<li>
  
    



<a  title="FAQ" href="https://networknt.github.io/faq/">
	
	FAQ
</a>



  
</li>



<li>
  
    



<a  title="License" href="https://www.apache.org/licenses/LICENSE-2.0">
	
	License
</a>



  
</li>



<li>
  
    



<a  title="Introduction" href="https://networknt.github.io/index.html">
	
	Introduction
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/stevehu" target="_blank" title="@stevehu on GitHub">
              @stevehu on GitHub
            </a>
          </li>
          

          
          <li>
            <a href="mailto:stevehu@gmail.com" title="Email of stevehu@gmail.com">
              Contact via email
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>API Gateway </h1>

			<p>When your organization is thinking about breaking up the big monolithic
application to adopt microservices architecture, chances are there are
some vendors coming to sell their gateway solutions. Why they want to
sell you gateways and do you really need a gateway?</p>

<p>The reason they are eagerly selling you a gateway is because they have
to monetize their product as soon as possible before it is obsolete.
The solutions they provided are not truely microservices as there is
no standalone gateway in the picture of the real microservices
architecture. Their solution is coming from web services(SOA) design
and all services behind the gateway are flattened.</p>

<p>The purpose of the gateway is to address cross-cutting concerns in Web
services as these are built on top of JavaEE platform with no capability
to address these concerns inside the application server. The foundation
of JavaEE is Servlet API which treats request and response immutable and
it doesn&rsquo;t provide a way to intercept request and response easyly in
servlet filter. The servlet API was designed around 2000 and it cannot be
changed due to backward compatibility. This leaves only one option to
address cross-cutting concerns on the network level. Normally JavaEE app
are designed as multiple layers and putting an extra layer as gateway is
very natural.</p>

<p>Here is a picture of their typical solution in the beginning.</p>

<p><img src="https://networknt.github.io/images/ms_oauth2_gateway.png" alt="ms_oauth2_gateway" /></p>

<p>After awhile, they realized that for every request from client, there
are two calls from client and api to OAuth2 server and remote calls
are too heavy.</p>

<p>Then the solution for gateway vendors is to move OAuth2 server inside
the gateway so that there is no remote calls between gateway and OAuth2
server for security verification. Here is an updated gateway.</p>

<p><img src="https://networknt.github.io/images/ms_oauth2_in_gateway.png" alt="ms_oauth2_in_gateway" /></p>

<p>With increasing volume, the monolithic gateway becomes bottleneck and
the only solutions is horizontal scaling. That means you have a cluster
of gateway instances and gateway becomes a single point of failure. If
any component fails in gateway, all your APIs are not accessible. It is
also very hard to scale as it is a big monolithic application with a lot
of components built in and uses a lot of CPU and memory.</p>

<p>When you look inside the APIs protected by the gateway, you can see
these APIs are implemented in JavaEE containers like
WebLogic/WebSphere/JBoss/SpringBoot etc. and they don&rsquo;t call each
other. They are simply monolithic JavaEE application packaged in ear
or war and exposed RESTful APIs. These APIs are normally deployed in Data
Centers and lately moved to cloud. They are not real microservices at
all.</p>

<p>Some smart developers attempted to break these big application into
smaller pieces and move into the direction of microservices but gateway
became a problem. Let&rsquo;s take a look at how API to API call looks like
with gateway in the following diagram.</p>

<p><img src="https://networknt.github.io/images/ms_gateway_api_to_api.png" alt="ms_gateway_api_to_api" /></p>

<p>As you can see, when API A calls API B, although both of them are behind
the gateway, the request has to go in front of gateway to properly
authenticate/authorize the request. Clearly, the centralized gateway
design is against the decentralized principle of microservices
architecture.</p>

<p>In our framework, the solution is to move all the cross cutting concerns
to the API framework and APIs are built on top of the framework. In other
words, a distributed gateway. Here is a diagram to show you client calls
API A and API A calls API B/API C and API B calls API D.</p>

<p><img src="https://networknt.github.io/images/ms_distributed_gateway.png" alt="ms_distributed_gateway" /></p>

<p>In this architecture, every API instance contains functions from the
framework and act like a mini gateway embedded. Along with container
orchestration tools like Kubernetes or Docker Swarm, the traditional
gateway is replaced. As there is no remote calls between API to gateway,
all the cross cutting concerns are addressed in the same request/response
chain. This gives you the best performance for your APIs. Here
is an <a href="https://networknt.github.io/light-4j/tutorials/microservices/">tutorial</a>
which implements the above diagram and source code for the four APIs can
be found <a href="https://github.com/networknt/light-example-4j">here</a></p>

<p>Our framework is built on top of Undertow http core server which is very
light and serves 1.4 million &ldquo;Hello World!&rdquo; requests on my desktop with
average response time 2ms. Is it 44 times faster then the most popular
RESTful container Sprint Boot with embedded Tomcat.</p>

<p>The performance test code can be found in
<a href="https://github.com/networknt/microservices-framework-benchmark">here</a></p>

<p>In the above diagram, OAuth2 server is an independent entity and you
might ask if it is a bottleneck. I have written another <a href="https://networknt.github.io/architecture/security">document</a>
to address it with distributed JWT token verification and client credentials
token caching and renewal. Basically, the Client module in the framework
caches the client credentials token until it is about to expire then renew
in the background.</p>

<p>Also, our own OAuth2 server built on top of light-rest-4j and light-hybrid-4j
frameworks is very fast that it can handle 60K user login to get authorization
code per second. For access token, it can serve about 700 access tokens in a
second. It is also open sourced and can be found at <a href="https://github.com/networknt/light-oauth2">https://github.com/networknt/light-oauth2</a></p>


			<aside class="copyright" role="note">
				
				&copy; 2017 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://networknt.github.io/architecture/security/" title="Security">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Security
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://networknt.github.io/getting-started/" title="Getting Started">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Getting Started
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = 'https:\/\/networknt.github.io\/';
      var repo_id  = 'networknt\/light-doc';
    
    </script>

    <script src="https://networknt.github.io/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

